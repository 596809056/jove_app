<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/biaodan.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<script type="text/javascript" src="../js/jquery-3.4.1.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.picker.min.js"></script>
		<script src="../js/app.js"></script>
		<style type="text/css">
			#inputTime,
			#outputTime {
				height: 40px;
				line-height: 10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="padding-right: 15px;">
			<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
				<span class="mui-icon mui-icon-left-nav"></span>
			</button>
			<h1 class="mui-title">中富移动办公</h1>
		</header>
		<div class="mui-content" id="">

			<div id="hcaption">
				压合板厚
			</div>
			<ul class="mui-list-unstyled mui-table-view biaodan" style="margin-top: 0;">
				<li class="mui-table-view-cell mui-collapse mui-active" style="color: cadetblue;text-align: left;padding: 0.5rem 1rem;">
					<a class="mui-navigate-right" href="#">条码信息</a>
					<div class="mui-collapse-content">
						<p><input id="barcode" type="text" class="scan" value="" data-id="tiaoma" placeholder="轻触以打开扫描" readonly="readonly" /></p>
					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="color: royalblue;text-align: left;padding:0.5rem 1rem;">
					<a class="mui-navigate-right" href="#">基础数据</a>
					<div class="mui-collapse-content">
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">厂别:</span>
							<span class="mui-col-xs-8"><input id="factoryName" type="text" value="" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">MO号:</span>
							<span class="mui-col-xs-8"><input id="mo" type="text" value="" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">生产编码:</span>
							<span class="mui-col-xs-8"><input id="mfg" type="text" value="" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">工单号:</span>
							<span class="mui-col-xs-8"><input id="wo" type="text" value="" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">客户代码:</span>
							<span class="mui-col-xs-8"><input id="custcode" type="text" value="" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">客户型号:</span>
							<span class="mui-col-xs-8"><input id="custpart" type="text" value="" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">LOT号:</span>
							<span class="mui-col-xs-8"><input id="lot" type="text" value="N/A" readonly /></span>
						</p>
						<p class="mui-row jichushuju">
							<span class="mui-col-xs-4">周期:</span>
							<span class="mui-col-xs-8"><input id="datecode" type="text" value="N/A" readonly /></span>
						</p>
						<p class="mui-row jichushuju" style="display: none;">
							<span class="mui-col-xs-4">d06rkey:</span>
							<span class="mui-col-xs-8"><input id="d06rkey" type="text" value="" readonly /></span>
						</p>

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse mui-active" style="color: coral;text-align: left;padding:0.5rem 1rem;">
					<a class="mui-navigate-right" href="#">实测数据</a>
					<div class="mui-collapse-content">
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">抽检数量:</span>
							<span class="mui-col-xs-8"><input id="checkQty" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">内层芯板厚要求:</span>
							<span class="mui-col-xs-8"><input id="corePlateThickRequire" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">是否含铜:</span>
							<span class="mui-col-xs-8">
								<select id="isCopper">
									<option value="" selected="selected">请选择</option>
									<option value="Y">是</option>
									<option value="N">否</option>
								</select>
							</span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">压板板厚要求:</span>
							<span class="mui-col-xs-8"><input id="prePlateThickReq" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">压板板厚公差:</span>
							<span class="mui-col-xs-8"><input id="prePlateThickTol" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">成品板厚要求:</span>
							<span class="mui-col-xs-8"><input id="finishedPlateThickReq" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">成品板厚公差:</span>
							<span class="mui-col-xs-8"><input id="finishedPlateThickTol" type="text" value="" /></span>
						</p>

						<p style="padding: 1rem;">实测板厚</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">1:</span>
							<span class="mui-col-xs-8"><input id="measurea" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">2:</span>
							<span class="mui-col-xs-8"><input id="measureb" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">3:</span>
							<span class="mui-col-xs-8"><input id="measurec" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">4:</span>
							<span class="mui-col-xs-8"><input id="measured" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">5:</span>
							<span class="mui-col-xs-8"><input id="measuree" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">6:</span>
							<span class="mui-col-xs-8"><input id="measuref" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">7:</span>
							<span class="mui-col-xs-8"><input id="measureg" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">8:</span>
							<span class="mui-col-xs-8"><input id="measureh" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">中间:</span>
							<span class="mui-col-xs-8"><input id="measurei" type="text" value="" /></span>
						</p>

						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">板厚符合要求:</span>
							<span class="mui-col-xs-8">
								<select id="isPlateThickReq">
									<option value="" selected="selected">请选择</option>
									<option value="Y">是</option>
									<option value="N">否</option>
								</select>
							</span>
						</p>
						<p class="mui-row shiceshuju">
							<span class="mui-col-xs-4">判定结果:</span>
							<span class="mui-col-xs-8 hradio">
								<label>ACC</label><input name="decide" value="ACCEPT" type="radio">
								<label>REJ</label><input name="decide" value="REJECT" type="radio">
							</span>
						</p>
						<p class="mui-row ">
							<span class="mui-col-xs-4">操作人:</span>
							<span class="mui-col-xs-8"><input id="operator" type="text" value="" /></span>
						</p>
						<p class="mui-row shiceshuju" style="display: none;">
							<span class="mui-col-xs-4">主管审核:</span>
							<span class="mui-col-xs-8"><input id="auditor" type="text" value="" /></span>
						</p>
					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="color: slategray;text-align: left;padding: 0.5rem 1rem;">
					<a class="mui-navigate-right" href="#">备注</a>
					<div class="mui-collapse-content">
						<textarea rows="5" cols="" id="remark"></textarea>
					</div>
				</li>
			</ul>
			<ul class="mui-list-inline" style="text-align: center;">
				<li><button id="submit" type="button" class="mui-btn mui-btn-blue mui-btn-outlined" style="background-color: #009688;color: #fff;border-radius: 2px;">提交</button></li>
				<li><button id="reset" type="button" class="mui-btn mui-btn-blue mui-btn-outlined">重置</button></li>
			</ul>
		</div>
	</body>

	<script type="text/javascript">
		// 表单
		document.getElementById("submit").addEventListener('tap', function() {
			var decide;
			isCopper = document.getElementById("isCopper");
			isPlateThickReq = document.getElementById("isPlateThickReq");
			document.querySelectorAll("input[name='decide']").forEach(function(el) {
				if (el.checked)
					decide = el.value;
			})

			var information = {
				isCopper: isCopper.options[isCopper.selectedIndex].value || '',
				isPlateThickReq: isPlateThickReq.options[isPlateThickReq.selectedIndex].value || '',
				checkQty: document.getElementById("checkQty").value || '',
				corePlateThickRequire: document.getElementById("corePlateThickRequire").value || '',
				prePlateThickReq: document.getElementById("prePlateThickReq").value || '',
				prePlateThickTol: document.getElementById("prePlateThickTol").value || '',
				finishedPlateThickReq: document.getElementById("finishedPlateThickReq").value || '',
				finishedPlateThickTol: document.getElementById("finishedPlateThickTol").value || '',
				measurea: document.getElementById("measurea").value || '',
				measureb: document.getElementById("measureb").value || '',
				measurec: document.getElementById("measurec").value || '',
				measured: document.getElementById("measured").value || '',
				measuree: document.getElementById("measuree").value || '',
				measuref: document.getElementById("measuref").value || '',
				measureg: document.getElementById("measureg").value || '',
				measureh: document.getElementById("measureh").value || '',
				measurei: document.getElementById("measurei").value || '',
				decide: decide || '',
				operator: document.getElementById("operator").value || ''
			}
			if (information.isCopper.length < 1 || information.isPlateThickReq.length < 1 ||
				information.checkQty.length < 1 || information.corePlateThickRequire.length < 1 ||
				information.prePlateThickReq.length < 1 || information.prePlateThickTol.length < 1 ||
				information.finishedPlateThickReq.length < 1 || information.finishedPlateThickTol.length < 1 ||
				information.measurea.length < 1 || information.measureb.length < 1 ||
				information.measurec.length < 1 || information.measured.length < 1 ||
				information.measuree.length < 1 || information.measuref.length < 1 ||
				information.measureg.length < 1 || information.measureh.length < 1 ||
				information.measurei.length < 1 || information.decide.length < 1 ||
				information.operator.length < 1) {
				var color = "#F9F900";
				if (information.isCopper.length < 1)
					$("#isCopper").css("background-color", color);
				if (information.isPlateThickReq.length < 1)
					$("#isPlateThickReq").css("background-color", color);
				if (information.checkQty.length < 1)
					$("#checkQty").css("background-color", color);
				if (information.corePlateThickRequire.length < 1)
					$("#corePlateThickRequire").css("background-color", color);
				if (information.prePlateThickReq.length < 1)
					$("#prePlateThickReq").css("background-color", color);
				if (information.prePlateThickTol.length < 1)
					$("#prePlateThickTol").css("background-color", color);
				if (information.finishedPlateThickReq.length < 1)
					$("#finishedPlateThickReq").css("background-color", color);
				if (information.finishedPlateThickTol.length < 1)
					$("#finishedPlateThickTol").css("background-color", color);
				if (information.measurea.length < 1)
					$("#measurea").css("background-color", color);
				if (information.measureb.length < 1)
					$("#measureb").css("background-color", color);
				if (information.measurec.length < 1)
					$("#measurec").css("background-color", color);
				if (information.measured.length < 1)
					$("#measured").css("background-color", color);
				if (information.measuree.length < 1)
					$("#measuree").css("background-color", color);
				if (information.measuref.length < 1)
					$("#measuref").css("background-color", color);
				if (information.measureg.length < 1)
					$("#measureg").css("background-color", color);
				if (information.measureh.length < 1)
					$("#measureh").css("background-color", color);
				if (information.measurei.length < 1)
					$("#measurei").css("background-color", color);
				if (information.decide.length < 1)
					$("#decide").css("background-color", color);
				if (information.operator.length < 1)
					$("#operator").css("background-color", color);
				plus.nativeUI.toast("黄色区域为必填项！");
				return;
			} else {
				if (!confirm("确认提交吗？"))
					return;

				if (document.getElementById("remark").value.length > 30) {
					mui.alert("备注超过30字");
					return;
				}
				var facarr = {
					'一厂': 1,
					'二厂': 2,
					'三厂': 3,
					'未知': 'N/A'
				}
				factoryName = facarr[document.getElementById("factoryName").value];
				var data = {
					factoryName: factoryName,
					mo: document.getElementById("mo").value,
					mfg: document.getElementById("mfg").value,
					wo: document.getElementById("wo").value,
					custcode: document.getElementById("custcode").value,
					custpart: document.getElementById("custpart").value,
					lot: document.getElementById("lot").value,
					datecode: document.getElementById("datecode").value,
					d06rkey: document.getElementById("d06rkey").value,


					isCopper: isCopper.options[isCopper.selectedIndex].value,
					isPlateThickReq: isPlateThickReq.options[isPlateThickReq.selectedIndex].value,
					checkQty: document.getElementById("checkQty").value,
					corePlateThickRequire: document.getElementById("corePlateThickRequire").value,
					prePlateThickReq: document.getElementById("prePlateThickReq").value,
					prePlateThickTol: document.getElementById("prePlateThickTol").value,
					finishedPlateThickReq: document.getElementById("finishedPlateThickReq").value,
					finishedPlateThickTol: document.getElementById("finishedPlateThickTol").value,
					measurea: document.getElementById("measurea").value,
					measureb: document.getElementById("measureb").value,
					measurec: document.getElementById("measurec").value,
					measured: document.getElementById("measured").value,
					measuree: document.getElementById("measuree").value,
					measuref: document.getElementById("measuref").value,
					measureg: document.getElementById("measureg").value,
					measureh: document.getElementById("measureh").value,
					measurei: document.getElementById("measurei").value,
					decide: decide,

					operator: document.getElementById("operator").value,
					auditor: document.getElementById("auditor").value,
					remark: document.getElementById("remark").value,
				}

				var params = JSON.stringify(data);
				mui.ajax({
					url: realapi + '/JOVE_QIS/query/saveVerifyData.action?id=73',
					type: "post",
					data: {
						params: params,
						isRejectItem: false,
					},
					dataType: "json",
					async: false,
					error: function() {
						mui.alert("error occur!");
					},
					success: function(data) {
						if (data.isOK) {
							mui.alert("上传成功!");
						} else {
							mui.alert("未知错误。");
						}
					}
				});
			}
		});

		function pad(num, n) {
			var len = num.toString().length;
			while (len < n) {
				num = "0" + num;
				len++;
			}
			return num;
		}
		(function($, doc) {
			//初始化 scan页
			$.init({
				preloadPages: [{
					id: 'scan.html',
					url: '../scan.html'
				}]
			});

			//自定义事件,供扫描回调
			window.addEventListener('getScan', function(event) {
				// 获得事件参数
				// var id = event.detail.id;
				qrtype = event.detail.qrtype;
				qrdata = event.detail.qrdata;
				// 赋值到输入框
				if (qrtype && qrdata) {
					// mui.alert(qrtype + ":" + qrdata );
					var arr = qrdata.split(',');
					if (arr.length > 2) {
						qrdata = arr[1];
					}

					document.querySelector("input[data-id='" + qrtype + "']").value = qrdata;

					if (qrtype == 'tiaoma') {
						// 采集数据
						mui.ajax(realapi + '/JOVE_QIS/query/queryCommonDataByWO.action?id=2', {
							data: {
								wo: qrdata,
								isControl: false
							},
							dataType: 'json', //服务器返回json格式数据
							type: 'post', //HTTP请求类型
							timeout: 3000, //超时时间设置为10秒；
							success: function(data) {
								if (data.success) {
									// 基础信息
									document.getElementById("mo").value = data.app.mo;
									document.getElementById("wo").value = data.app.wo;
									document.getElementById("mfg").value = data.app.mfg;
									document.getElementById("custcode").value = data.app.cust_code;
									document.getElementById("custpart").value = data.app.pn;
									document.getElementById("lot").value = data.app.lot;
									document.getElementById("datecode").value = data.app.datecode;
									document.getElementById("d06rkey").value = data.app.d06rkey;

									document.getElementById("corePlateThickRequire").value = data.app.corerequirethick;
									document.getElementById("finishedPlateThickReq").value = data.app.platethickness;
									document.getElementById("finishedPlateThickTol").value = data.app.thicktolerance;

								} else {
									mui.alert(data.mess);
								}
							},
							error: function(xhr, type, errorThrown) {
								//异常处理
								if (type == "timeout")
									$.toast('连接超时，请检查网络')

								$.toast('系统异常，请检查是否连接jove-wifi')
							}
						})
					}
				}
			});

			$.plusReady(function() {
				// 获取本页面的固定信息
				var self = plus.webview.currentWebview();

				// 扫描页webview
				var scanPage = null;
				document.querySelectorAll(".scan").forEach(function(el) {
					el.addEventListener('tap', function() {
						// 扫描页webview
						if (!scanPage) {
							scanPage = plus.webview.getWebviewById('scan.html');
						}
						// 这里只有qrtype 是不一样的,根据el来
						var qrtype = el.getAttribute("data-id");
						mui.fire(scanPage, 'newScan', {
							qrtype: qrtype,
							source: self.openurl,
							sourceid: self.id
						});
						mui.openWindow({
							id: 'scan.html'
						});
					})
				})

				// 登录状态消息
				var state = app.getState();
				document.getElementById("factoryName").value = state.changbie;
				document.getElementById("operator").value = state.username;

				var date = new Date();
				// 日期控件
				// var pickerf = function(){
				// 	
				// 	var _self = this;
				// 	if(_self.picker) {
				// 		_self.picker.show(function (rs) {
				// 			_self.innerHTML = rs.text;
				// 			_self.picker.dispose();
				// 			_self.picker = null;
				// 		});
				// 	} else {
				// 		var current = date.getFullYear() + "-" + pad((date.getMonth() + 1).toString() , 2) + "-" + pad(date.getDate() , 2);
				// 		current += " " + pad(date.getHours(),2) + ":" + pad(date.getMinutes(),2);
				// 		var options = {
				// 			"value":current,
				// 			"beginYear":2019,
				// 			"endYear":2038
				// 		};
				// 		console.log("当前时间:" + current);
				// 		var id = this.getAttribute('id');
				// 		
				// 		_self.picker = new $.DtPicker(options);
				// 		_self.picker.show(function(rs) {
				// 			_self.innerHTML = rs.text;
				// 			_self.picker.dispose();
				// 			_self.picker = null;
				// 		});
				// 	}
				// }
				// document.getElementById("inputTime").addEventListener('tap',pickerf);
				// document.getElementById("outputTime").addEventListener('tap',pickerf);

				document.getElementById("reset").addEventListener('tap', function() {
					if (!confirm("确认重置吗？"))
						return;

					document.querySelectorAll(".shiceshuju input[type='text']").forEach(function(el) {
						el.value = '';
					})
					document.querySelectorAll(".shiceshuju button").forEach(function(el) {
						el.innerHTML = '';
					})
					document.querySelectorAll(".shiceshuju input[type='radio']").forEach(function(el) {
						el.checked = '';
					})
					document.querySelectorAll(".shiceshuju input[type='checkbox']").forEach(function(el) {
						el.checked = '';
					})
				});

			});

		}(mui, document));
	</script>
</html>
